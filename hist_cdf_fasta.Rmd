---
title: "Study the parsed fasta file"
output:
  word_document: default
  html_notebook: default
Author: Valisha Shah
Date: 12/30/2024
---

### Read the data 
```{r}

# Load the necessary libraries
library(ggplot2)
library(data.table)

# Read the TSV file generated by the Python script
data <- fread("/Users/valishashah/Desktop/all_projects/HaLab_assessment/Sequencing_analysis_assignment/parsed_fasta_data.tsv", header = TRUE, sep = "\t")


```

# Step 1: Plot the distribution of read lengths as a histogram
```{r}

ggplot(data, aes(x = length)) +
  geom_histogram(binwidth = 100, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of Read Lengths", x = "Read Length", y = "Frequency") +
  theme_minimal()

### A lot of short reads 
### Very few long reads 


### zoom into the 0-4000 read lengths 
ggplot(data, aes(x = length)) +
  geom_histogram(binwidth = 100, fill = "skyblue", color = "black", alpha = 0.7) +
  labs(title = "Distribution of Read Lengths", x = "Read Length", y = "Frequency") +
  theme_minimal() + 
  xlim(c(0, 4000))


```


### Step 2: Calculate the cumulative distribution of 2-mer frequencies
```{r}

# Extract the columns corresponding to 2-mer counts (columns 5 to 20)
two_mer_columns <- colnames(data)[5:20]

# Define a function to calculate 2-mer frequencies for a sequence
calculate_two_mer_frequencies <- function(row) {
  # Get the counts of each 2-mer
  print(row[two_mer_columns])
  counts <- as.numeric(row[two_mer_columns])

  # Add 1 to each count to obtain pseudo-counts
  pseudo_counts <- counts + 1
  print(pseudo_counts)
  
  # Calculate the total number of pseudo-counts
  total_count <- sum(pseudo_counts)
  
  # Calculate the frequency of each 2-mer
  frequencies <- pseudo_counts / total_count
  
  return(frequencies)
}

# Apply the function to each row to get the frequencies of 2-mers
two_mer_frequencies <- t(apply(data, 1, calculate_two_mer_frequencies))

# Create a data frame for plotting
two_mer_df <- data.frame(two_mer_frequencies)
two_mer_df$sequence <- 1:nrow(data)  # Adding a sequence number for tracking

# Reshape the data frame to long format for plotting
library(tidyr)
long_data <- gather(two_mer_df, key = "two_mer", value = "frequency", -sequence)

# Plot the cumulative distribution of 2-mer frequencies
ggplot(long_data, aes(x = frequency, color = two_mer)) +
  stat_ecdf(geom = "step") +
  labs(title = "Cumulative Distribution of 2-mer Frequencies", x = "2-mer Frequency", y = "Cumulative Probability") +
  theme_minimal() +
  theme(legend.position = "none")


```


```{r}

# Load required libraries
library(ggplot2)

# Example genomic sequences
sequences <- data$`5-mer`

# Function to calculate 2-mer frequencies
calculate_2mer_frequency <- function(sequence) {
  # Initialize an empty list to store 2-mer counts
  counts <- list()
  
  # Loop through the sequence and count 2-mers
  for (i in 1:(nchar(sequence) - 1)) {
    kmer <- substr(sequence, i, i + 1)
    if (kmer %in% names(counts)) {
      counts[[kmer]] <- counts[[kmer]] + 1
    } else {
      counts[[kmer]] <- 1
    }
  }
  
  # Add pseudo-count of 1 to each 2-mer count
  pseudo_counts <- sapply(counts, function(x) x + 1)
  
  # Calculate the total sum of pseudo-counts
  total_count <- sum(pseudo_counts)
  
  # Calculate the frequency of each 2-mer
  frequencies <- pseudo_counts / total_count
  return(frequencies)
}

# Collect frequencies for all sequences
all_frequencies <- unlist(lapply(sequences, calculate_2mer_frequency))

# Plot the cumulative distribution
ggplot(data.frame(frequency = all_frequencies), aes(x = frequency)) +
  stat_ecdf(geom = "step", aes(y = ..y..), color = "blue") +
  labs(title = "Cumulative Distribution of 2-mer Frequencies", 
       x = "Frequency", 
       y = "Cumulative Frequency") +
  theme_minimal()


```







